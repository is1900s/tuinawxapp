<!-- æœåŠ¡é€‰æ‹©ç»„ä»¶ -->
<view class="service-selector">
  <!-- ç»„ä»¶æ ‡é¢˜ -->
  <view class="selector-header" wx:if="{{showHeader}}">
    <text class="selector-title">{{title}}</text>
    <text class="selector-subtitle" wx:if="{{subtitle}}">{{subtitle}}</text>
  </view>

  <!-- æœåŠ¡åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-tabs" wx:if="{{categories.length > 0}}">
    <scroll-view class="category-scroll" scroll-x="true">
      <view class="category-list">
        <text
          class="category-item {{selectedCategory === '' ? 'active' : ''}}"
          bindtap="onCategoryChange"
          data-category=""
        >å…¨éƒ¨</text>
        <text
          class="category-item {{selectedCategory === item.id ? 'active' : ''}}"
          wx:for="{{categories}}"
          wx:key="id"
          bindtap="onCategoryChange"
          data-category="{{item.id}}"
        >{{item.name}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- æœåŠ¡åˆ—è¡¨ -->
  <scroll-view class="service-scroll" scroll-y="true" style="height: {{scrollHeight}}">
    <view class="service-list">
      <!-- æœåŠ¡é¡¹ç›®å¡ç‰‡ -->
      <view
        class="service-item {{selectedService.id === item.id ? 'selected' : ''}}"
        wx:for="{{filteredServices}}"
        wx:key="id"
        bindtap="onServiceSelect"
        data-service="{{item}}"
      >
        <!-- æœåŠ¡å›¾æ ‡å’ŒåŸºæœ¬ä¿¡æ¯ -->
        <view class="service-header">
          <image class="service-icon" src="{{item.icon}}" mode="aspectFit" />
          <view class="service-info">
            <view class="service-name-row">
              <text class="service-name">{{item.name}}</text>
              <view class="service-badges">
                <text class="badge badge-popular" wx:if="{{item.isPopular}}">çƒ­é—¨</text>
                <text class="badge badge-recommended" wx:if="{{item.isRecommended}}">æ¨è</text>
              </view>
            </view>
            <text class="service-desc">{{item.description}}</text>
          </view>
        </view>

        <!-- æœåŠ¡è¯¦æƒ… -->
        <view class="service-details">
          <!-- æ—¶é—´å’Œä»·æ ¼ -->
          <view class="service-meta">
            <view class="time-info">
              <text class="time-label">æ—¶é•¿ï¼š</text>
              <text class="time-value">{{item.duration}}åˆ†é’Ÿ</text>
            </view>
            <view class="price-info">
              <text class="price-current">Â¥{{item.price}}</text>
              <text class="price-original" wx:if="{{item.originalPrice && item.originalPrice > item.price}}">Â¥{{item.originalPrice}}</text>
            </view>
          </view>

          <!-- æŠ€å¸ˆè¦æ±‚ -->
          <view class="technician-requirement" wx:if="{{item.technicianRequirement}}">
            <text class="requirement-label">æŠ€å¸ˆè¦æ±‚ï¼š</text>
            <text class="requirement-text">{{item.technicianRequirement}}</text>
          </view>

          <!-- é€‚ç”¨äººç¾¤ -->
          <view class="suitable-people" wx:if="{{item.suitablePeople}}">
            <text class="suitable-label">é€‚ç”¨ï¼š</text>
            <text class="suitable-text">{{item.suitablePeople}}</text>
          </view>

          <!-- æœåŠ¡æ•ˆæœ -->
          <view class="service-effects" wx:if="{{item.effects && item.effects.length > 0}}">
            <text class="effects-label">æ•ˆæœï¼š</text>
            <view class="effects-list">
              <text
                class="effect-item"
                wx:for="{{item.effects}}"
                wx:for-item="effect"
                wx:key="*this"
              >{{effect}}</text>
            </view>
          </view>
        </view>

        <!-- é€‰æ‹©æŒ‡ç¤ºå™¨ -->
        <view class="select-indicator" wx:if="{{selectedService.id === item.id}}">
          <text class="indicator-icon">âœ“</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredServices.length === 0}}">
        <text class="empty-icon">ğŸ”</text>
        <text class="empty-title">æš‚æ— ç›¸å…³æœåŠ¡</text>
        <text class="empty-desc">è¯·å°è¯•é€‰æ‹©å…¶ä»–åˆ†ç±»</text>
      </view>
    </view>
  </scroll-view>

  <!-- é€‰ä¸­æœåŠ¡ä¿¡æ¯å±•ç¤º -->
  <view class="selected-service-info" wx:if="{{selectedService.id && showSelectedInfo}}">
    <view class="selected-header">
      <text class="selected-title">å·²é€‰æ‹©æœåŠ¡</text>
      <text class="selected-change" bindtap="onClearSelection">é‡æ–°é€‰æ‹©</text>
    </view>
    <view class="selected-details">
      <text class="selected-name">{{selectedService.name}}</text>
      <view class="selected-meta">
        <text class="selected-duration">{{selectedService.duration}}åˆ†é’Ÿ</text>
        <text class="selected-price">Â¥{{selectedService.price}}</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons" wx:if="{{showActions}}">
    <button class="btn btn-outline" bindtap="onCancel" wx:if="{{showCancel}}">å–æ¶ˆ</button>
    <button
      class="btn btn-primary"
      bindtap="onConfirm"
      disabled="{{!selectedService.id}}"
    >ç¡®è®¤é€‰æ‹©</button>
  </view>
</view>

<!-- æœåŠ¡è¯¦æƒ…å¼¹çª— -->
<view class="service-detail-modal {{showDetailModal ? 'show' : ''}}" bindtap="onDetailModalClose">
  <view class="detail-content" catchtap="onDetailModalContentTap">
    <view class="detail-header">
      <text class="detail-title">æœåŠ¡è¯¦æƒ…</text>
      <text class="detail-close" bindtap="onDetailModalClose">Ã—</text>
    </view>

    <scroll-view class="detail-scroll" scroll-y="true" wx:if="{{detailService}}">
      <!-- æœåŠ¡å›¾ç‰‡ -->
      <image class="detail-image" src="{{detailService.image}}" mode="aspectFill" wx:if="{{detailService.image}}" />

      <!-- æœåŠ¡ä¿¡æ¯ -->
      <view class="detail-info">
        <text class="detail-name">{{detailService.name}}</text>
        <text class="detail-desc">{{detailService.description}}</text>

        <!-- æœåŠ¡ç‰¹è‰² -->
        <view class="detail-features" wx:if="{{detailService.features}}">
          <text class="features-title">æœåŠ¡ç‰¹è‰²</text>
          <view class="features-list">
            <text
              class="feature-item"
              wx:for="{{detailService.features}}"
              wx:key="*this"
            >{{item}}</text>
          </view>
        </view>

        <!-- æ³¨æ„äº‹é¡¹ -->
        <view class="detail-notices" wx:if="{{detailService.notices}}">
          <text class="notices-title">æ³¨æ„äº‹é¡¹</text>
          <view class="notices-list">
            <text
              class="notice-item"
              wx:for="{{detailService.notices}}"
              wx:key="*this"
            >{{index + 1}}. {{item}}</text>
          </view>
        </view>

        <!-- æœåŠ¡æµç¨‹ -->
        <view class="detail-process" wx:if="{{detailService.process}}">
          <text class="process-title">æœåŠ¡æµç¨‹</text>
          <view class="process-steps">
            <view
              class="process-step"
              wx:for="{{detailService.process}}"
              wx:key="*this"
            >
              <text class="step-number">{{index + 1}}</text>
              <text class="step-text">{{item}}</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <view class="detail-footer">
      <button class="btn btn-outline" bindtap="onDetailModalClose">å…³é—­</button>
      <button
        class="btn btn-primary"
        bindtap="onSelectFromDetail"
        data-service="{{detailService}}"
      >é€‰æ‹©æ­¤æœåŠ¡</button>
    </view>
  </view>
</view>