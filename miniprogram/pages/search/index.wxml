<!-- æœç´¢é¡µé¢ -->
<view class="search-page">
  <!-- æœç´¢å¤´éƒ¨ -->
  <view class="search-header">
    <view class="search-bar">
      <view class="search-input-wrapper">
        <text class="search-icon">ğŸ”</text>
        <input
          class="search-input"
          type="text"
          placeholder="æœç´¢æŠ€å¸ˆã€æœåŠ¡æˆ–è®¢å•"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          focus="{{autoFocus}}"
        />
        <view class="clear-btn" wx:if="{{searchKeyword}}" bindtap="onClearSearch">
          <text class="clear-icon">Ã—</text>
        </view>
      </view>
      <text class="cancel-btn" bindtap="onCancel">å–æ¶ˆ</text>
    </view>

    <!-- æœç´¢ç­›é€‰ -->
    <view class="search-filters" wx:if="{{showFilters}}">
      <scroll-view class="filters-scroll" scroll-x="true">
        <view class="filter-tabs">
          <text
            class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
            bindtap="onFilterChange"
            data-filter="all"
          >å…¨éƒ¨</text>
          <text
            class="filter-tab {{currentFilter === 'technician' ? 'active' : ''}}"
            bindtap="onFilterChange"
            data-filter="technician"
          >æŠ€å¸ˆ</text>
          <text
            class="filter-tab {{currentFilter === 'service' ? 'active' : ''}}"
            bindtap="onFilterChange"
            data-filter="service"
          >æœåŠ¡</text>
          <text
            class="filter-tab {{currentFilter === 'order' ? 'active' : ''}}"
            bindtap="onFilterChange"
            data-filter="order"
          >è®¢å•</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- æœç´¢å†…å®¹åŒºåŸŸ -->
  <scroll-view class="search-content" scroll-y="true" style="height: {{contentHeight}}">
    <!-- æœç´¢å†å² -->
    <view class="search-history" wx:if="{{!searchKeyword && searchHistory.length > 0}}">
      <view class="history-header">
        <text class="history-title">æœç´¢å†å²</text>
        <text class="history-clear" bindtap="onClearHistory">æ¸…ç©º</text>
      </view>
      <view class="history-list">
        <view
          class="history-item"
          wx:for="{{searchHistory}}"
          wx:key="*this"
          bindtap="onHistoryTap"
          data-keyword="{{item}}"
        >
          <text class="history-icon">ğŸ•</text>
          <text class="history-text">{{item}}</text>
          <text class="history-delete" bindtap="onHistoryDelete" data-keyword="{{item}}">Ã—</text>
        </view>
      </view>
    </view>

    <!-- çƒ­é—¨æœç´¢ -->
    <view class="hot-search" wx:if="{{!searchKeyword}}">
      <view class="hot-header">
        <text class="hot-title">çƒ­é—¨æœç´¢</text>
      </view>
      <view class="hot-list">
        <text
          class="hot-item"
          wx:for="{{hotSearches}}"
          wx:key="*this"
          bindtap="onHotTap"
          data-keyword="{{item}}"
        >{{item}}</text>
      </view>
    </view>

    <!-- æ¨èæœåŠ¡ -->
    <view class="recommend-services" wx:if="{{!searchKeyword}}">
      <view class="recommend-header">
        <text class="recommend-title">æ¨èæœåŠ¡</text>
        <text class="recommend-more" bindtap="onMoreServices">æ›´å¤š ></text>
      </view>
      <view class="service-grid">
        <view
          class="service-item"
          wx:for="{{recommendServices}}"
          wx:key="id"
          bindtap="onServiceTap"
          data-service="{{item}}"
        >
          <image class="service-icon" src="{{item.icon}}" mode="aspectFit" />
          <text class="service-name">{{item.name}}</text>
          <text class="service-desc">{{item.description}}</text>
        </view>
      </view>
    </view>

    <!-- æœç´¢ç»“æœ -->
    <view class="search-results" wx:if="{{searchKeyword}}">
      <!-- æœç´¢çŠ¶æ€æç¤º -->
      <view class="search-status" wx:if="{{searching}}">
        <text class="status-icon">â³</text>
        <text class="status-text">æ­£åœ¨æœç´¢...</text>
      </view>

      <!-- æœç´¢ç»“æœç»Ÿè®¡ -->
      <view class="result-stats" wx:if="{{!searching && searchResults.length > 0}}">
        <text class="stats-text">æ‰¾åˆ° {{totalResults}} ä¸ªç›¸å…³ç»“æœ</text>
        <view class="sort-options" wx:if="{{currentFilter === 'technician'}}">
          <text
            class="sort-option {{sortBy === 'distance' ? 'active' : ''}}"
            bindtap="onSortChange"
            data-sort="distance"
          >è·ç¦»ä¼˜å…ˆ</text>
          <text
            class="sort-option {{sortBy === 'rating' ? 'active' : ''}}"
            bindtap="onSortChange"
            data-sort="rating"
          >è¯„åˆ†ä¼˜å…ˆ</text>
        </view>
      </view>

      <!-- æŠ€å¸ˆæœç´¢ç»“æœ -->
      <view class="technician-results" wx:if="{{currentFilter === 'all' || currentFilter === 'technician'}}">
        <view class="result-section-title" wx:if="{{currentFilter === 'all' && technicianResults.length > 0}}">
          <text class="section-title">æŠ€å¸ˆ</text>
        </view>
        <view class="technician-list">
          <view
            class="technician-card"
            wx:for="{{technicianResults}}"
            wx:key="id"
            bindtap="onTechnicianTap"
            data-technician="{{item}}"
          >
            <image class="technician-avatar" src="{{item.avatar}}" mode="aspectFill" />
            <view class="technician-info">
              <text class="technician-name">{{item.name}}</text>
              <view class="technician-meta">
                <text class="rating">{{item.rating}} â­</text>
                <text class="distance">{{item.distance}}km</text>
              </view>
              <text class="technician-desc">{{item.description}}</text>
            </view>
            <view class="technician-tags">
              <text
                class="tag"
                wx:for="{{item.tags}}"
                wx:for-item="tag"
                wx:key="*this"
              >{{tag}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æœåŠ¡æœç´¢ç»“æœ -->
      <view class="service-results" wx:if="{{currentFilter === 'all' || currentFilter === 'service'}}">
        <view class="result-section-title" wx:if="{{currentFilter === 'all' && serviceResults.length > 0}}">
          <text class="section-title">æœåŠ¡</text>
        </view>
        <view class="service-result-list">
          <view
            class="service-result-card"
            wx:for="{{serviceResults}}"
            wx:key="id"
            bindtap="onServiceResultTap"
            data-service="{{item}}"
          >
            <view class="service-result-header">
              <image class="service-result-icon" src="{{item.icon}}" mode="aspectFit" />
              <view class="service-result-info">
                <text class="service-result-name">{{item.name}}</text>
                <text class="service-result-price">Â¥{{item.price}}/{{item.duration}}åˆ†é’Ÿ</text>
              </view>
            </view>
            <text class="service-result-desc">{{item.description}}</text>
          </view>
        </view>
      </view>

      <!-- è®¢å•æœç´¢ç»“æœ -->
      <view class="order-results" wx:if="{{currentFilter === 'all' || currentFilter === 'order'}}">
        <view class="result-section-title" wx:if="{{currentFilter === 'all' && orderResults.length > 0}}">
          <text class="section-title">è®¢å•</text>
        </view>
        <view class="order-result-list">
          <view
            class="order-result-card"
            wx:for="{{orderResults}}"
            wx:key="id"
            bindtap="onOrderTap"
            data-order="{{item}}"
          >
            <view class="order-result-header">
              <text class="order-no">{{item.orderNo}}</text>
              <view class="order-status status-{{item.status}}">
                <text class="status-text">{{getStatusText(item.status)}}</text>
              </view>
            </view>
            <view class="order-result-content">
              <text class="service-name">{{item.serviceName}}</text>
              <text class="technician-name">æŠ€å¸ˆï¼š{{item.technicianName}}</text>
              <text class="order-date">{{item.createdAt}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ— æœç´¢ç»“æœ -->
      <view class="empty-results" wx:if="{{!searching && searchResults.length === 0}}">
        <text class="empty-icon">ğŸ”</text>
        <text class="empty-title">æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</text>
        <text class="empty-desc">å»ºè®®å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ£€æŸ¥æ‹¼å†™</text>
        <view class="empty-suggestions" wx:if="{{searchSuggestions.length > 0}}">
          <text class="suggestions-title">æœç´¢å»ºè®®</text>
          <view class="suggestions-list">
            <text
              class="suggestion-item"
              wx:for="{{searchSuggestions}}"
              wx:key="*this"
              bindtap="onSuggestionTap"
              data-keyword="{{item}}"
            >{{item}}</text>
          </view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore && !searching}}">
        <text class="load-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>
    </view>
  </scroll-view>

  <!-- æœç´¢å»ºè®®ä¸‹æ‹‰ -->
  <view class="search-suggestions" wx:if="{{showSuggestions && suggestions.length > 0}}">
    <view class="suggestions-list">
      <view
        class="suggestion-item"
        wx:for="{{suggestions}}"
        wx:key="*this"
        bindtap="onSuggestionSelect"
        data-suggestion="{{item}}"
      >
        <text class="suggestion-icon">ğŸ’¡</text>
        <text class="suggestion-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œæ  -->
  <view class="quick-actions" wx:if="{{showQuickActions}}">
    <view class="quick-action" bindtap="onVoiceSearch">
      <text class="quick-icon">ğŸ¤</text>
      <text class="quick-text">è¯­éŸ³æœç´¢</text>
    </view>
    <view class="quick-action" bindtap="onScanSearch">
      <text class="quick-icon">ğŸ“·</text>
      <text class="quick-text">æ‰«ç æœç´¢</text>
    </view>
    <view class="quick-action" bindtap="onNearbySearch">
      <text class="quick-icon">ğŸ“</text>
      <text class="quick-text">é™„è¿‘æŠ€å¸ˆ</text>
    </view>
  </view>

  <!-- æœç´¢å†å²ç®¡ç†å¼¹çª— -->
  <view class="history-modal {{showHistoryModal ? 'show' : ''}}" bindtap="onHistoryModalClose">
    <view class="history-content" catchtap="onHistoryModalContentTap">
      <view class="history-modal-header">
        <text class="modal-title">æœç´¢å†å²ç®¡ç†</text>
        <text class="modal-close" bindtap="onHistoryModalClose">Ã—</text>
      </view>

      <view class="history-modal-body">
        <view class="history-stats">
          <text class="stats-text">å…± {{searchHistory.length}} æ¡å†å²è®°å½•</text>
          <text class="clear-all" bindtap="onClearAllHistory">å…¨éƒ¨æ¸…ç©º</text>
        </view>

        <view class="history-options">
          <label class="option-item">
            <checkbox checked="{{saveHistory}}" bindchange="onSaveHistoryChange" />
            <text class="option-text">ä¿å­˜æœç´¢å†å²</text>
          </label>
          <label class="option-item">
            <checkbox checked="{{smartSuggestion}}" bindchange="onSmartSuggestionChange" />
            <text class="option-text">æ™ºèƒ½æœç´¢å»ºè®®</text>
          </label>
          <label class="option-item">
            <checkbox checked="{{voiceSearch}}" bindchange="onVoiceSearchChange" />
            <text class="option-text">è¯­éŸ³æœç´¢åŠŸèƒ½</text>
          </label>
        </view>

        <view class="history-tags" wx:if="{{searchHistory.length > 0}}">
          <text class="tags-title">é«˜é¢‘æœç´¢</text>
          <view class="tags-list">
            <text
              class="tag-item"
              wx:for="{{getFrequentSearches()}}"
              wx:key="*this"
            >{{item}}</text>
          </view>
        </view>
      </view>

      <view class="history-modal-footer">
        <button class="btn btn-primary" bindtap="onHistoryModalClose">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- è¯­éŸ³æœç´¢å¼¹çª— -->
  <view class="voice-search-modal {{showVoiceModal ? 'show' : ''}}" bindtap="onVoiceModalClose">
    <view class="voice-content" catchtap="onVoiceModalContentTap">
      <view class="voice-header">
        <text class="voice-title">è¯­éŸ³æœç´¢</text>
        <text class="voice-close" bindtap="onVoiceModalClose">Ã—</text>
      </view>

      <view class="voice-body">
        <view class="voice-animation {{isRecording ? 'recording' : ''}}">
          <view class="voice-wave">
            <view class="wave-line" wx:for="{{[1,2,3,4,5,6,7]}}" wx:key="*this"></view>
          </view>
          <text class="voice-status">{{isRecording ? 'æ­£åœ¨å½•éŸ³...' : 'ç‚¹å‡»å¼€å§‹'}}</text>
        </view>

        <text class="voice-result" wx:if="{{voiceResult}}">
          è¯†åˆ«ç»“æœï¼š{{voiceResult}}
        </text>

        <view class="voice-controls">
          <button
            class="voice-btn {{isRecording ? 'recording' : ''}}"
            bindtouchstart="onVoiceStart"
            bindtouchend="onVoiceEnd"
          >
            <text class="voice-btn-icon">{{isRecording ? 'â– ' : 'ğŸ¤'}}</text>
          </button>
          <button class="voice-btn secondary" bindtap="onVoiceRetry" wx:if="{{voiceResult}}">
            <text class="retry-icon">ğŸ”„</text>
            é‡è¯•
          </button>
        </view>

        <view class="voice-tips">
          <text class="tip-item">â€¢ ç‚¹å‡»éº¦å…‹é£å¼€å§‹å½•éŸ³</text>
          <text class="tip-item">â€¢ è¯´å‡ºæŠ€å¸ˆå§“åæˆ–æœåŠ¡ç±»å‹</text>
          <text class="tip-item">â€¢ æ¾å¼€åœæ­¢å½•éŸ³å¹¶è¯†åˆ«</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</view>