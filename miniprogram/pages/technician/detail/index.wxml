<!-- æŠ€å¸ˆè¯¦æƒ…é¡µ -->
<scroll-view class="technician-detail-page" scroll-y="true" bindscrolltolower="onLoadMore">
  <!-- æŠ€å¸ˆå¤´éƒ¨ä¿¡æ¯ -->
  <view class="technician-header">
    <!-- èƒŒæ™¯å›¾ç‰‡ -->
    <image class="header-bg" src="{{technicianInfo.backgroundImage || '/assets/images/default-bg.jpg'}}" mode="aspectFill" />

    <!-- æŠ€å¸ˆåŸºæœ¬ä¿¡æ¯ -->
    <view class="technician-basic-info">
      <view class="avatar-section">
        <image class="technician-avatar" src="{{technicianInfo.avatar}}" mode="aspectFill" />
        <view class="status-indicator status-{{technicianInfo.status}}" wx:if="{{technicianInfo.status}}">
          <text class="status-text">{{getStatusText(technicianInfo.status)}}</text>
        </view>
      </view>

      <view class="info-section">
        <view class="name-row">
          <text class="technician-name">{{technicianInfo.name}}</text>
          <view class="technician-badges">
            <text class="badge badge-verified" wx:if="{{technicianInfo.verified}}">å·²è®¤è¯</text>
            <text class="badge badge-experienced" wx:if="{{technicianInfo.experience >= 5}}">{{technicianInfo.experience}}å¹´ç»éªŒ</text>
            <text class="badge badge-top" wx:if="{{technicianInfo.isTop}}">é‡‘ç‰ŒæŠ€å¸ˆ</text>
          </view>
        </view>

        <view class="rating-row">
          <view class="rating-info">
            <text class="rating-stars">{{technicianInfo.rating}} â­</text>
            <text class="rating-count">{{technicianInfo.commentCount || 0}}æ¡è¯„ä»·</text>
          </view>
          <text class="order-count">æœåŠ¡{{technicianInfo.orderCount || 0}}æ¬¡</text>
        </view>

        <view class="meta-row">
          <text class="response-time">{{technicianInfo.responseTime || 15}}åˆ†é’Ÿå“åº”</text>
          <text class="completion-rate">{{technicianInfo.completionRate || 98}}%å®Œæˆç‡</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <view class="action-item" bindtap="onContact">
          <text class="action-icon">ğŸ“</text>
          <text class="action-text">è”ç³»</text>
        </view>
        <view class="action-item" bindtap="onFavorite">
          <text class="action-icon">{{technicianInfo.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="action-text">{{technicianInfo.isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
        </view>
        <view class="action-item" bindtap="onShare">
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœåŠ¡é¡¹ç›® -->
  <view class="service-section card">
    <view class="section-header">
      <text class="section-title">æœåŠ¡é¡¹ç›®</text>
      <text class="service-count">{{technicianInfo.services.length || 0}}é¡¹</text>
    </view>

    <view class="service-list">
      <view
        class="service-item"
        wx:for="{{technicianInfo.services}}"
        wx:key="id"
        bindtap="onServiceSelect"
        data-service="{{item}}"
      >
        <view class="service-header">
          <image class="service-icon" src="{{item.icon}}" mode="aspectFit" />
          <view class="service-info">
            <text class="service-name">{{item.name}}</text>
            <text class="service-desc">{{item.description}}</text>
          </view>
          <view class="service-price">
            <text class="price-current">Â¥{{item.price}}</text>
            <text class="price-unit">/{{item.duration}}åˆ†é’Ÿ</text>
          </view>
        </view>

        <!-- æœåŠ¡ç‰¹è‰² -->
        <view class="service-features" wx:if="{{item.features}}">
          <text
            class="feature-tag"
            wx:for="{{item.features}}"
            wx:for-item="feature"
            wx:key="*this"
          >{{feature}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æŠ€å¸ˆç®€ä»‹ -->
  <view class="intro-section card" wx:if="{{technicianInfo.introduction}}">
    <view class="section-header">
      <text class="section-title">æŠ€å¸ˆç®€ä»‹</text>
    </view>
    <text class="intro-text">{{technicianInfo.introduction}}</text>
  </view>

  <!-- ä¸“ä¸šæŠ€èƒ½ -->
  <view class="skills-section card" wx:if="{{technicianInfo.skills && technicianInfo.skills.length > 0}}">
    <view class="section-header">
      <text class="section-title">ä¸“ä¸šæŠ€èƒ½</text>
    </view>

    <view class="skills-grid">
      <view
        class="skill-item"
        wx:for="{{technicianInfo.skills}}"
        wx:key="name"
      >
        <view class="skill-icon">{{item.icon}}</view>
        <text class="skill-name">{{item.name}}</text>
        <view class="skill-level">
          <view class="level-stars">
            <text
              class="star {{index < item.level ? 'filled' : ''}}"
              wx:for="{{[1,2,3,4,5]}}"
              wx:key="*this"
            >â˜…</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å·¥ä½œç»å† -->
  <view class="experience-section card" wx:if="{{technicianInfo.experience && technicianInfo.experience.length > 0}}">
    <view class="section-header">
      <text class="section-title">å·¥ä½œç»å†</text>
    </view>

    <view class="experience-list">
      <view
        class="experience-item"
        wx:for="{{technicianInfo.experience}}"
        wx:key="id"
      >
        <view class="experience-period">
          <text class="period-start">{{item.startDate}}</text>
          <text class="period-separator">~</text>
          <text class="period-end">{{item.endDate || 'è‡³ä»Š'}}</text>
        </view>
        <view class="experience-content">
          <text class="experience-company">{{item.company}}</text>
          <text class="experience-position">{{item.position}}</text>
          <text class="experience-desc" wx:if="{{item.description}}">{{item.description}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯ä¹¦èµ„è´¨ -->
  <view class="certificates-section card" wx:if="{{technicianInfo.certificates && technicianInfo.certificates.length > 0}}">
    <view class="section-header">
      <text class="section-title">è¯ä¹¦èµ„è´¨</text>
    </view>

    <scroll-view class="certificates-scroll" scroll-x="true">
      <view class="certificates-list">
        <view
          class="certificate-item"
          wx:for="{{technicianInfo.certificates}}"
          wx:key="id"
          bindtap="onCertificateTap"
          data-certificate="{{item}}"
        >
          <image class="certificate-image" src="{{item.image}}" mode="aspectFill" />
          <text class="certificate-name">{{item.name}}</text>
          <text class="certificate-issuer">{{item.issuer}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ç”¨æˆ·è¯„ä»· -->
  <view class="reviews-section card">
    <view class="section-header">
      <text class="section-title">ç”¨æˆ·è¯„ä»·</text>
      <view class="rating-summary">
        <text class="summary-rating">{{technicianInfo.rating || 5.0}}</text>
        <text class="summary-count">{{technicianInfo.commentCount || 0}}æ¡è¯„ä»·</text>
      </view>
    </view>

    <!-- è¯„åˆ†åˆ†å¸ƒ -->
    <view class="rating-distribution">
      <view
        class="rating-bar"
        wx:for="{{[5,4,3,2,1]}}"
        wx:key="*this"
      >
        <text class="rating-label">{{item}}æ˜Ÿ</text>
        <view class="rating-progress">
          <view
            class="rating-fill"
            style="width: {{getRatingPercentage(item)}}%"
          ></view>
        </view>
        <text class="rating-count">{{getRatingCount(item)}}</text>
      </view>
    </view>

    <!-- è¯„ä»·æ ‡ç­¾ -->
    <view class="review-tags" wx:if="{{reviewTags.length > 0}}">
      <text
        class="review-tag"
        wx:for="{{reviewTags}}"
        wx:key="*this"
      >{{item}}</text>
    </view>

    <!-- è¯„ä»·åˆ—è¡¨ -->
    <view class="review-list">
      <view
        class="review-item"
        wx:for="{{reviews}}"
        wx:key="id"
        bindtap="onReviewTap"
        data-review="{{item}}"
      >
        <view class="review-header">
          <image class="reviewer-avatar" src="{{item.userAvatar}}" mode="aspectFill" />
          <view class="reviewer-info">
            <text class="reviewer-name">{{item.userName}}</text>
            <text class="review-date">{{item.date}}</text>
          </view>
          <view class="review-rating">
            <text class="rating-stars">{{item.rating}} â­</text>
          </view>
        </view>

        <text class="review-content">{{item.content}}</text>

        <!-- æœåŠ¡ä¿¡æ¯ -->
        <view class="review-service" wx:if="{{item.serviceName}}">
          <text class="service-label">æœåŠ¡é¡¹ç›®ï¼š</text>
          <text class="service-name">{{item.serviceName}}</text>
        </view>

        <!-- è¯„ä»·å›¾ç‰‡ -->
        <view class="review-images" wx:if="{{item.images && item.images.length > 0}}">
          <image
            class="review-image"
            wx:for="{{item.images}}"
            wx:for-item="image"
            wx:key="*this"
            src="{{image}}"
            mode="aspectFill"
            bindtap="onImagePreview"
            data-urls="{{item.images}}"
            data-current="{{image}}"
          />
        </view>

        <!-- æ ‡ç­¾ -->
        <view class="review-tags-small" wx:if="{{item.tags && item.tags.length > 0}}">
          <text
            class="tag-small"
            wx:for="{{item.tags}}"
            wx:for-item="tag"
            wx:key="*this"
          >{{tag}}</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMoreReviews}}">
      <text class="load-text">{{loadingReviews ? 'åŠ è½½ä¸­...' : 'æŸ¥çœ‹æ›´å¤šè¯„ä»·'}}</text>
    </view>
  </view>

  <!-- æœåŠ¡æ—¶é—´ -->
  <view class="schedule-section card">
    <view class="section-header">
      <text class="section-title">æœåŠ¡æ—¶é—´</text>
    </view>

    <view class="schedule-grid">
      <view
        class="schedule-item"
        wx:for="{{technicianInfo.schedule}}"
        wx:key="day"
      >
        <text class="schedule-day">{{item.day}}</text>
        <text class="schedule-time {{item.available ? 'available' : 'unavailable'}}">
          {{item.available ? item.timeRange : 'ä¸å¯é¢„çº¦'}}
        </text>
      </view>
    </view>
  </view>

  <!-- æœåŠ¡èŒƒå›´ -->
  <view class="service-area-section card" wx:if="{{technicianInfo.serviceArea}}">
    <view class="section-header">
      <text class="section-title">æœåŠ¡èŒƒå›´</text>
      <text class="area-distance">{{technicianInfo.serviceArea.maxDistance}}kmå†…</text>
    </view>

    <view class="area-info">
      <text class="area-desc">{{technicianInfo.serviceArea.description}}</text>
      <view class="area-districts" wx:if="{{technicianInfo.serviceArea.districts}}">
        <text
          class="district-tag"
          wx:for="{{technicianInfo.serviceArea.districts}}"
          wx:key="*this"
        >{{item}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨é¢„çº¦æ  -->
  <view class="bottom-bar">
    <view class="price-info">
      <text class="price-label">å‚è€ƒä»·æ ¼</text>
      <text class="price-range">Â¥{{technicianInfo.minPrice}}-Â¥{{technicianInfo.maxPrice}}</text>
    </view>
    <button class="btn-book" bindtap="onBookNow">
      ç«‹å³é¢„çº¦
    </button>
  </view>

  <!-- åœ°å›¾æ¨¡å¼å…¥å£ -->
  <view class="map-toggle" bindtap="onShowMap">
    <text class="toggle-icon">ğŸ—ºï¸</text>
    <text class="toggle-text">æŸ¥çœ‹ä½ç½®</text>
  </view>

<!-- å›¾ç‰‡é¢„è§ˆ -->
<view class="image-preview-modal {{showImagePreview ? 'show' : ''}}" bindtap="onImagePreviewClose">
  <view class="preview-content" catchtap="onImagePreviewContentTap">
    <swiper
      class="preview-swiper"
      indicator-dots="{{previewImages.length > 1}}"
      current="{{previewIndex}}"
      bindchange="onPreviewChange"
    >
      <swiper-item wx:for="{{previewImages}}" wx:key="*this">
        <image class="preview-image" src="{{item}}" mode="aspectFit" />
      </swiper-item>
    </swiper>
    <text class="preview-close" bindtap="onImagePreviewClose">Ã—</text>
  </view>
</view>

<!-- è”ç³»å¼¹çª— -->
<view class="contact-modal {{showContactModal ? 'show' : ''}}" bindtap="onContactModalClose">
  <view class="contact-content" catchtap="onContactModalContentTap">
    <view class="contact-header">
      <text class="contact-title">è”ç³»æŠ€å¸ˆ</text>
      <text class="contact-close" bindtap="onContactModalClose">Ã—</text>
    </view>

    <view class="contact-options">
      <view class="contact-option" bindtap="onPhoneCall">
        <text class="contact-icon">ğŸ“</text>
        <text class="contact-text">ç”µè¯è”ç³»</text>
      </view>
      <view class="contact-option" bindtap="onSendMessage">
        <text class="contact-icon">ğŸ’¬</text>
        <text class="contact-text">å‘é€æ¶ˆæ¯</text>
      </view>
      <view class="contact-option" bindtap="onWechatContact">
        <text class="contact-icon">ğŸ“±</text>
        <text class="contact-text">å¾®ä¿¡è”ç³»</text>
      </view>
    </view>
  </view>
</view>

<!-- å®‰å…¨åŒºåŸŸé€‚é… -->
<view class="safe-area-bottom"></view>
</scroll-view>