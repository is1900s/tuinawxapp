<!-- ç”¨æˆ·ä¸ªäººä¸­å¿ƒé¡µ -->
<scroll-view class="profile-page" scroll-y="true">
  <!-- ç”¨æˆ·å¤´éƒ¨ä¿¡æ¯ -->
  <view class="user-header">
    <!-- èƒŒæ™¯è£…é¥° -->
    <view class="header-decoration"></view>

    <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
    <view class="user-info">
      <!-- å¤´åƒ -->
      <view class="avatar-section" bindtap="onAvatarTap">
        <image class="user-avatar" src="{{userInfo.avatar || '/assets/images/avatars/default.png'}}" mode="aspectFill" />
        <view class="avatar-edit" wx:if="{{isCurrentUser}}">
          <text class="edit-icon">ğŸ“·</text>
        </view>
      </view>

      <!-- ç”¨æˆ·åå’ŒçŠ¶æ€ -->
      <view class="user-details">
        <text class="user-name">{{userInfo.nickName || 'å¾®ä¿¡ç”¨æˆ·'}}</text>
        <view class="user-status">
          <text class="status-text">{{getUserStatusText()}}</text>
          <view class="user-badges">
            <text class="badge badge-vip" wx:if="{{userInfo.vipLevel}}">VIP{{userInfo.vipLevel}}</text>
            <text class="badge badge-new" wx:if="{{isNewUser}}">æ–°ç”¨æˆ·</text>
          </view>
        </view>
      </view>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="user-stats">
        <view class="stat-item" bindtap="onOrdersTap">
          <text class="stat-number">{{userStats.orderCount || 0}}</text>
          <text class="stat-label">è®¢å•</text>
        </view>
        <view class="stat-item" bindtap="onFavoritesTap">
          <text class="stat-number">{{userStats.favoriteCount || 0}}</text>
          <text class="stat-label">æ”¶è—</text>
        </view>
        <view class="stat-item" bindtap="onCouponsTap">
          <text class="stat-number">{{userStats.couponCount || 0}}</text>
          <text class="stat-label">ä¼˜æƒ åˆ¸</text>
        </view>
        <view class="stat-item" bindtap="onPointsTap">
          <text class="stat-number">{{userStats.points || 0}}</text>
          <text class="stat-label">ç§¯åˆ†</text>
        </view>
      </view>
    </view>
  </view>

  <!-- VIPä¼šå‘˜å¡ç‰‡ -->
  <view class="vip-card" wx:if="{{!userInfo.vipLevel}}" bindtap="onVipTap">
    <view class="vip-content">
      <view class="vip-info">
        <text class="vip-title">å¼€é€šVIPä¼šå‘˜</text>
        <text class="vip-desc">äº«å—ä¸“å±ä¼˜æƒ å’Œç‰¹æƒæœåŠ¡</text>
      </view>
      <text class="vip-action">ç«‹å³å¼€é€š</text>
    </view>
    <view class="vip-decoration">
      <text class="vip-icon">ğŸ‘‘</text>
    </view>
  </view>

  <!-- è®¢å•ç®¡ç† -->
  <view class="order-section card">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„è®¢å•</text>
      <text class="section-more" bindtap="onAllOrdersTap">å…¨éƒ¨è®¢å• ></text>
    </view>

    <view class="order-types">
      <view
        class="order-type"
        wx:for="{{orderTypes}}"
        wx:key="type"
        bindtap="onOrderTypeTap"
        data-type="{{item.type}}"
      >
        <view class="type-icon-wrapper">
          <text class="type-icon">{{item.icon}}</text>
          <view class="type-badge" wx:if="{{item.count > 0}}">
            <text class="badge-count">{{item.count > 99 ? '99+' : item.count}}</text>
          </view>
        </view>
        <text class="type-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- å¸¸ç”¨å·¥å…· -->
  <view class="tools-section card">
    <view class="section-header">
      <text class="section-title">å¸¸ç”¨å·¥å…·</text>
    </view>

    <view class="tools-grid">
      <view
        class="tool-item"
        wx:for="{{commonTools}}"
        wx:key="name"
        bindtap="onToolTap"
        data-tool="{{item}}"
      >
        <view class="tool-icon-wrapper {{item.color}}">
          <text class="tool-icon">{{item.icon}}</text>
        </view>
        <text class="tool-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- æœåŠ¡è®°å½• -->
  <view class="service-section card">
    <view class="section-header">
      <text class="section-title">æœåŠ¡è®°å½•</text>
      <text class="section-more" bindtap="onAllServicesTap">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>

    <view class="service-list">
      <view
        class="service-item"
        wx:for="{{recentServices}}"
        wx:key="id"
        bindtap="onServiceTap"
        data-service="{{item}}"
      >
        <image class="service-avatar" src="{{item.technicianAvatar}}" mode="aspectFill" />
        <view class="service-info">
          <text class="service-name">{{item.serviceName}}</text>
          <text class="service-technician">{{item.technicianName}}</text>
          <text class="service-date">{{item.date}}</text>
        </view>
        <view class="service-status status-{{item.status}}">
          <text class="status-text">{{item.statusText}}</text>
        </view>
      </view>

      <view class="empty-services" wx:if="{{recentServices.length === 0}}">
        <text class="empty-icon">ğŸ“‹</text>
        <text class="empty-text">æš‚æ— æœåŠ¡è®°å½•</text>
      </view>
    </view>
  </view>

  <!-- æˆ‘çš„ä¼˜æƒ åˆ¸ -->
  <view class="coupons-section card" wx:if="{{availableCoupons.length > 0}}">
    <view class="section-header">
      <text class="section-title">ä¼˜æƒ åˆ¸</text>
      <text class="section-more" bindtap="onAllCouponsTap">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>

    <scroll-view class="coupons-scroll" scroll-x="true">
      <view class="coupons-list">
        <view
          class="coupon-item"
          wx:for="{{availableCoupons.slice(0, 3)}}"
          wx:key="id"
          bindtap="onCouponTap"
          data-coupon="{{item}}"
        >
          <view class="coupon-left">
            <text class="coupon-amount">Â¥{{item.discount}}</text>
            <text class="coupon-condition">æ»¡{{item.minAmount}}å…ƒå¯ç”¨</text>
          </view>
          <view class="coupon-right">
            <text class="coupon-title">{{item.name}}</text>
            <text class="coupon-expire">{{item.expireDate}}å‰æœ‰æ•ˆ</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åœ°å€ç®¡ç† -->
  <view class="address-section card">
    <view class="section-header">
      <text class="section-title">åœ°å€ç®¡ç†</text>
      <text class="section-more" bindtap="onAddressManageTap">ç®¡ç†åœ°å€ ></text>
    </view>

    <view class="address-list">
      <view
        class="address-item"
        wx:for="{{userAddresses.slice(0, 2)}}"
        wx:key="id"
        bindtap="onAddressTap"
        data-address="{{item}}"
      >
        <view class="address-info">
          <view class="address-header">
            <text class="address-name">{{item.name}}</text>
            <text class="address-phone">{{item.phone}}</text>
            <text class="address-tag" wx:if="{{item.isDefault}}">é»˜è®¤</text>
          </view>
          <text class="address-detail">{{item.fullAddress}}</text>
        </view>
        <text class="address-arrow">></text>
      </view>

      <view class="empty-address" wx:if="{{userAddresses.length === 0}}">
        <text class="empty-text">è¿˜æ²¡æœ‰æ·»åŠ åœ°å€</text>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®é€‰é¡¹ -->
  <view class="settings-section card">
    <view class="section-header">
      <text class="section-title">è®¾ç½®</text>
    </view>

    <view class="settings-list">
      <view
        class="setting-item"
        wx:for="{{settingsOptions}}"
        wx:key="name"
        bindtap="onSettingTap"
        data-setting="{{item}}"
      >
        <view class="setting-left">
          <text class="setting-icon">{{item.icon}}</text>
          <text class="setting-name">{{item.name}}</text>
        </view>
        <view class="setting-right">
          <text class="setting-value" wx:if="{{item.value}}">{{item.value}}</text>
          <text class="setting-arrow">></text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¸®åŠ©ä¸åé¦ˆ -->
  <view class="help-section card">
    <view class="section-header">
      <text class="section-title">å¸®åŠ©ä¸åé¦ˆ</text>
    </view>

    <view class="help-options">
      <view
        class="help-item"
        wx:for="{{helpOptions}}"
        wx:key="name"
        bindtap="onHelpTap"
        data-help="{{item}}"
      >
        <text class="help-icon">{{item.icon}}</text>
        <text class="help-name">{{item.name}}</text>
        <text class="help-arrow">></text>
      </view>
    </view>
  </view>

  <!-- å…³äºæˆ‘ä»¬ -->
  <view class="about-section card">
    <view class="about-content">
      <view class="app-info">
        <text class="app-name">åŒåŸæ¨æ‹¿</text>
        <text class="app-version">ç‰ˆæœ¬ {{appVersion}}</text>
      </view>
      <text class="about-desc">ä¸“ä¸šçš„ä¸Šé—¨æ¨æ‹¿æœåŠ¡å¹³å°</text>
    </view>

    <view class="about-actions">
      <text class="about-action" bindtap="onAboutTap">å…³äºæˆ‘ä»¬</text>
      <text class="about-divider">|</text>
      <text class="about-action" bindtap="onPrivacyTap">éšç§æ”¿ç­–</text>
      <text class="about-divider">|</text>
      <text class="about-action" bindtap="onTermsTap">æœåŠ¡åè®®</text>
    </view>
  </view>

  <!-- åº•éƒ¨é—´è· -->
  <view class="bottom-spacer"></view>
</scroll-view>

<!-- ç¼–è¾‘èµ„æ–™å¼¹çª— -->
<view class="edit-profile-modal {{showEditModal ? 'show' : ''}}" bindtap="onEditModalClose">
  <view class="edit-content" catchtap="onEditModalContentTap">
    <view class="edit-header">
      <text class="edit-title">ç¼–è¾‘èµ„æ–™</text>
      <text class="edit-close" bindtap="onEditModalClose">Ã—</text>
    </view>

    <view class="edit-form">
      <!-- å¤´åƒ -->
      <view class="form-group">
        <text class="form-label">å¤´åƒ</text>
        <view class="avatar-upload" bindtap="onChooseAvatar">
          <image class="upload-avatar" src="{{editForm.avatar || '/assets/images/avatars/default.png'}}" mode="aspectFill" />
          <view class="upload-overlay">
            <text class="upload-icon">ğŸ“·</text>
          </view>
        </view>
      </view>

      <!-- æ˜µç§° -->
      <view class="form-group">
        <text class="form-label">æ˜µç§°</text>
        <input
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥æ˜µç§°"
          value="{{editForm.nickName}}"
          bindinput="onNickNameInput"
          maxlength="20"
        />
      </view>

      <!-- æ€§åˆ« -->
      <view class="form-group">
        <text class="form-label">æ€§åˆ«</text>
        <radio-group class="gender-selector" bindchange="onGenderChange">
          <label class="gender-option">
            <radio value="male" checked="{{editForm.gender === 'male'}}" />
            <text class="gender-text">ç”·</text>
          </label>
          <label class="gender-option">
            <radio value="female" checked="{{editForm.gender === 'female'}}" />
            <text class="gender-text">å¥³</text>
          </label>
        </radio-group>
      </view>

      <!-- ç”Ÿæ—¥ -->
      <view class="form-group">
        <text class="form-label">ç”Ÿæ—¥</text>
        <picker
          mode="date"
          value="{{editForm.birthday}}"
          bindchange="onBirthdayChange"
        >
          <view class="picker-view">
            <text class="picker-text">{{editForm.birthday || 'è¯·é€‰æ‹©ç”Ÿæ—¥'}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>

    <view class="edit-footer">
      <button class="btn btn-outline" bindtap="onEditModalClose">å–æ¶ˆ</button>
      <button class="btn btn-primary" bindtap="onSaveProfile">ä¿å­˜</button>
    </view>
  </view>
</view>

<!-- å›¾ç‰‡é¢„è§ˆ -->
<view class="image-preview-modal {{showImagePreview ? 'show' : ''}}" bindtap="onImagePreviewClose">
  <view class="preview-content" catchtap="onImagePreviewContentTap">
    <image class="preview-image" src="{{previewImage}}" mode="aspectFit" />
    <text class="preview-close" bindtap="onImagePreviewClose">Ã—</text>
  </view>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-area-bottom"></view>